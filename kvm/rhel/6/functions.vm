# -*-Shell-script-*-
#
# requires:
#  bash
#
# imports:
#  disk:       rmdisk, unmapptab_r
#  distro:     is_dev
#  hypervisor: umount_ptab
#

##

function trap_vm() {
  local disk_filename=$1 chroot_dir=$2
  [[ -d ${chroot_dir} ]] && umount_ptab ${chroot_dir} || :
  is_dev ${disk_filename} || {
    unmapptab_r ${disk_filename}
    rmdisk ${disk_filename}
  }
}
